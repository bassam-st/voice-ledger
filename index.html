<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø¯ÙØªØ± ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#16a34a" />

  <style>
    * { box-sizing: border-box; }
    :root {
      --green: #16a34a;
      --green-dark: #15803d;
      --red: #dc2626;
      --bg: #0f172a;
      --card: #0b1120;
      --card-soft: #020617;
      --border: rgba(148,163,184,.35);
      --muted: #94a3b8;
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 0 0, #1f2937 0, #020617 40%);
      color: #e5e7eb;
      min-height: 100vh;
    }

    .page {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      padding-bottom: 40px;
    }

    .app-card {
      background: radial-gradient(circle at top left, #1e293b 0, #020617 55%);
      border-radius: 28px;
      padding: 16px;
      box-shadow: 0 24px 80px rgba(15,23,42,.95);
      border: 1px solid rgba(148,163,184,.4);
    }

    .app-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 20%, rgba(56,189,248,.95), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(16,185,129,.9), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(56,189,248,.5), transparent 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0f172a;
      font-weight: 800;
      font-size: 1.1rem;
      box-shadow: 0 12px 32px rgba(34,197,94,.45);
    }

    .app-header-text h1 {
      margin: 0 0 2px 0;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 2px 10px;
      font-size: .75rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #cbd5f5;
      background: rgba(15,23,42,.7);
    }

    .app-header-text p {
      margin: 0;
      font-size: .78rem;
      color: #9ca3af;
    }

    .pill span.badge {
      border-radius: 999px;
      padding: 0 8px;
      font-size: .7rem;
      background: rgba(22,163,74,.1);
      color: #bbf7d0;
      border: 1px solid rgba(52,211,153,.58);
    }

    .section-title {
      margin: 10px 0 4px 0;
      font-size: .9rem;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .section-title small {
      font-size: .7rem;
      color: #9ca3af;
    }

    .tabs {
      display: flex;
      gap: 6px;
      margin: 6px 0 10px 0;
      overflow-x: auto;
      padding-bottom: 2px;
    }

    .tab {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148,163,184,.6);
      padding: 6px 10px;
      font-size: .75rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      white-space: nowrap;
    }
    .tab span.icon {
      font-size: 1rem;
    }
    .tab small {
      font-size: .7rem;
      color: #9ca3af;
    }
    .tab.active {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      border-color: #4ade80;
      color: #022c22;
    }

    .tabs::-webkit-scrollbar {
      height: 3px;
    }
    .tabs::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,.6);
      border-radius: 999px;
    }

    .grid {
      display: grid;
      gap: 12px;
    }
    @media (min-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: 1.5fr 1fr;
      }
    }

    .surface {
      background: radial-gradient(circle at top, rgba(15,23,42,.95), #020617);
      border-radius: 20px;
      padding: 10px 12px;
      border: 1px solid rgba(148,163,184,.35);
      box-shadow: 0 18px 50px rgba(15,23,42,.9);
    }

    .surface-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 8px;
    }

    .surface-header h2 {
      margin: 0;
      font-size: .85rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .surface-header h2 span {
      font-size: 1rem;
    }

    .surface-header small {
      font-size: .7rem;
      color: #9ca3af;
    }

    .surface-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    button {
      font-family: inherit;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148,163,184,.35);
      padding: 5px 9px;
      background: rgba(15,23,42,.9);
      color: #e5e7eb;
      font-size: .75rem;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }
    .btn span.icon {
      font-size: 1rem;
    }
    .btn-primary {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      border-color: #4ade80;
      color: #022c22;
      box-shadow: 0 10px 30px rgba(22,163,74,.75);
    }

    .btn-ghost {
      background: rgba(15,23,42,0.7);
      border-style: dashed;
      border-color: rgba(148,163,184,.55);
      color: #e5e7eb;
    }

    .btn-icon-only {
      padding: 4px 6px;
      width: 28px;
      justify-content: center;
    }

    .pill-btn {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148,163,184,.4);
      padding: 7px 10px;
      font-size: .8rem;
      background: rgba(15,23,42,.95);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
    }

    .pill-green {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      border-color: #4ade80;
      color: #052e16;
      box-shadow: 0 10px 30px rgba(22,163,74,.85);
    }
    .pill-gray {
      background: rgba(15,23,42,.9);
      border-style: dashed;
      border-color: rgba(148,163,184,.6);
      color: #e5e7eb;
    }

    .field-group {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
    }
    @media (max-width: 600px) {
      .field-group {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    label {
      font-size: .75rem;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    label span.req {
      color: #f97316;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.4);
      background: radial-gradient(circle at top, rgba(15,23,42,.97), #020617);
      color: #e5e7eb;
      padding: 6px 10px;
      font-size: .8rem;
      outline: none;
      width: 100%;
    }

    textarea {
      border-radius: 16px;
      min-height: 60px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148,163,184,.7);
    }

    .entries {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 2px;
      max-height: 240px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .entry-row {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, .9fr) minmax(0, 1fr) minmax(0, .9fr) auto;
      gap: 4px;
      align-items: center;
    }
    @media (max-width: 720px) {
      .entry-row {
        grid-template-columns: minmax(0, 2.3fr) minmax(0, .9fr) minmax(0, .9fr) auto;
        grid-template-rows: auto auto;
      }
      .entry-row select.entry-dir {
        grid-column: span 2;
      }
    }

    .entry-row input[type="number"] {
      text-align: center;
    }

    .entry-row select,
    .entry-row input {
      font-size: .78rem;
      padding-inline: 6px;
    }

    .chip {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: .7rem;
      border: 1px solid rgba(148,163,184,.4);
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    #whatsAppText {
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,.4);
      background: radial-gradient(circle at top, rgba(15,23,42,1), #020617);
      color: #e5e7eb;
      padding: 8px;
      font-size: .78rem;
      white-space: pre-wrap;
      line-height: 1.5;
      max-height: 260px;
      overflow-y: auto;
    }

    .hint {
      font-size: .7rem;
      color: #9ca3af;
      margin-top: 4px;
    }

    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 6px 0 0 0;
    }

    .stat-pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 4px 8px;
      font-size: .7rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.95);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .stat-pill span.label {
      color: #9ca3af;
    }

    .section {
      margin-top: 12px;
    }

    .section h3 {
      margin: 0 0 4px 0;
      font-size: .8rem;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .section h3 span.icon {
      font-size: 1rem;
    }

    .section small {
      font-size: .7rem;
      color: #9ca3af;
    }

    .list {
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,.3);
      background: rgba(15,23,42,.9);
      max-height: 240px;
      overflow-y: auto;
      margin-top: 6px;
    }

    .list-item {
      padding: 6px 8px;
      border-bottom: 1px dashed rgba(51,65,85,.9);
      cursor: pointer;
      font-size: .78rem;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .list-item:last-child {
      border-bottom: none;
    }
    .list-item:hover {
      background: rgba(15,23,42,.96);
    }

    .list-item .meta {
      font-size: .7rem;
      color: #9ca3af;
    }

    .pill-sm {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 1px 6px;
      font-size: .65rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.95);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .totals-box {
      border-radius: 12px;
      border: 1px dashed rgba(148,163,184,.6);
      background: rgba(15,23,42,.9);
      padding: 6px 8px;
      font-size: .78rem;
      white-space: pre-wrap;
      margin-top: 6px;
    }

    .clients-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .clients-search {
      flex: 1;
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .clients-search input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.4);
      background: radial-gradient(circle at top, rgba(15,23,42,.97), #020617);
      color: #e5e7eb;
      padding: 5px 10px;
      font-size: .78rem;
    }

    .badge-sm {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 2px 6px;
      font-size: .7rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.95);
    }

    .voice-chip {
      border-radius: 999px;
      border: 1px solid rgba(52,211,153,.6);
      background: rgba(6,95,70,.2);
      padding: 2px 8px;
      font-size: .7rem;
      color: #a7f3d0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .voice-chip span.icon {
      font-size: .9rem;
    }

    .voice-status {
      font-size: .7rem;
      color: #9ca3af;
      margin-top: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .voice-status span.dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 4px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,.4);
    }

    .voice-status span.dot.idle {
      background: #64748b;
      box-shadow: none;
    }

    .badge-intent {
      border-radius: 999px;
      border: 1px solid rgba(129,140,248,.7);
      padding: 1px 7px;
      font-size: .65rem;
      color: #e0e7ff;
      background: rgba(30,64,175,.8);
    }

    .badge-sentiment {
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,.15);
      padding: 1px 7px;
      font-size: .65rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.9);
    }

    .badge-source {
      border-radius: 999px;
      border: 1px solid rgba(52,211,153,.6);
      padding: 1px 7px;
      font-size: .65rem;
      color: #a7f3d0;
      background: rgba(6,95,70,.35);
    }

    .footer {
      margin-top: 14px;
      font-size: .7rem;
      color: #6b7280;
      text-align: center;
    }

    .footer a {
      color: #93c5fd;
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .intents-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .intent-pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 2px 8px;
      font-size: .7rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .intent-pill span.dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    .intent-pill span.dot.action { background: #22c55e; }
    .intent-pill span.dot.query  { background: #38bdf8; }
    .intent-pill span.dot.smalltalk { background: #facc15; }

    .badge-small {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 1px 6px;
      font-size: .65rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.95);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .history-list {
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,.3);
      background: rgba(15,23,42,.95);
      max-height: 200px;
      overflow-y: auto;
      margin-top: 6px;
      font-size: .75rem;
    }

    .history-item {
      padding: 6px 8px;
      border-bottom: 1px dashed rgba(30,64,175,.8);
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }
    .history-item:last-child {
      border-bottom: none;
    }
    .history-item .meta {
      color: #9ca3af;
      font-size: .68rem;
    }

    .badge-date {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      padding: 1px 6px;
      font-size: .65rem;
      color: #e5e7eb;
      background: rgba(15,23,42,.95);
    }

    .badge-amount {
      border-radius: 999px;
      border: 1px solid rgba(45,212,191,.7);
      padding: 1px 6px;
      font-size: .68rem;
      color: #ccfbf1;
      background: rgba(15,23,42,.9);
    }

    .whatsapp-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: space-between;
      align-items: center;
    }

    .whatsapp-row .left {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .badge-wa {
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,.9);
      padding: 2px 7px;
      font-size: .7rem;
      color: #bbf7d0;
      background: rgba(22,163,74,.3);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      justify-content: flex-end;
    }

    .tag {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.4);
      padding: 1px 7px;
      font-size: .65rem;
      color: #cbd5f5;
      background: rgba(15,23,42,.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .tag span.dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="app-card">
      <div class="app-header">
        <div class="logo-circle">Ø¨</div>
        <div class="app-header-text">
          <h1>
            Ø¯ÙØªØ± ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
            <span class="pill">
              <span>âš™ï¸</span>
              Ù…Ø­Ø±Ùƒ Ø°ÙƒØ§Ø¡ Ø¨Ø³ÙŠØ·
              <span class="badge">ØªØ¬Ø±ÙŠØ¨ÙŠ</span>
            </span>
          </h1>
          <p>Ø³Ø¬Ù‘Ù„ Ù…ØµØ±ÙˆÙØ§ØªÙƒ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø·Ø§Ù„Ø¹ ÙƒØ´ÙˆÙØ§Øª Ø³Ø±ÙŠØ¹Ø©ØŒ ÙˆØ´Ø§Ø±ÙƒÙ‡Ø§ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ â€” Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯ ØµÙˆØªÙŠ Ø°ÙƒÙŠ ÙŠÙÙ‡Ù… Ù„ØºØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.</p>
        </div>
      </div>

      <div class="section-title">
        <div>
          ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„
          <small>Ø§Ø®ØªÙØ± ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</small>
        </div>
        <div class="chip">
          <span>â­</span> Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
        </div>
      </div>

      <div class="tabs" id="modeTabs">
        <button class="tab active" data-mode="statements">
          <span class="icon">ğŸ“„</span>
          <div>
            <div>ÙƒØ´Ù Ù…ØµØ±ÙˆÙØ§Øª Ø¬Ø¯ÙŠØ¯</div>
            <small>ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù† ÙˆØ§Ø­Ø¯ ÙˆØ§Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„</small>
          </div>
        </button>
        <button class="tab" data-mode="clients">
          <span class="icon">ğŸ‘¥</span>
          <div>
            <div>Ø¹Ù…Ù„Ø§Ø¡ + ÙƒØ´ÙˆÙØ§Øª Ø³Ø§Ø¨Ù‚Ø©</div>
            <small>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØ´ÙˆÙ</small>
          </div>
        </button>
        <button class="tab" data-mode="reports">
          <span class="icon">ğŸ“Š</span>
          <div>
            <div>ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø§Ø¨ Ø¹Ù…ÙŠÙ„</div>
            <small>Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡ â€” Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©</small>
          </div>
        </button>
        <button class="tab" data-mode="voice">
          <span class="icon">ğŸ™ï¸</span>
          <div>
            <div>Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø³Ù‘Ø§Ù… Ø§Ù„ØµÙˆØªÙŠ</div>
            <small>ØªØ³Ø¬ÙŠÙ„ ÙƒØ´Ù Ø£Ùˆ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø§Ù„ØµÙˆØª</small>
          </div>
        </button>
      </div>

      <!-- ====== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ¶Ø¹: ÙƒØ´Ù Ù…ØµØ±ÙˆÙØ§Øª Ø¬Ø¯ÙŠØ¯ ===== -->
      <div id="modeStatements" class="mode-panel">
        <div class="grid grid-cols-2">
          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ§¾</span> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ´Ù</h2>
                <small>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†ØŒ Ø«Ù… Ø£Ø¶Ù Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø§Ù„ØªÙØµÙŠÙ„</small>
              </div>
              <div class="surface-toolbar">
                <button class="btn-ghost btn" id="copyLastClientBtn">
                  <span class="icon">â†©ï¸</span> Ø¢Ø®Ø± Ø¹Ù…ÙŠÙ„
                </button>
                <button class="btn-ghost btn" id="todayBtn">
                  <span class="icon">ğŸ“†</span> ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
                </button>
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ <span class="req">*</span></label>
                <input type="text" id="clientNameInput" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù„Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©">
              </div>
              <div class="field">
                <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ´Ù</label>
                <input type="date" id="dateInput">
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ´Ù</label>
                <input type="text" id="titleInput" placeholder="Ù…Ø«Ø§Ù„: ÙƒØ´Ù Ù…ØµØ±ÙˆÙØ§Øª Ø¨ÙŠØ§Ù† Ø±Ù‚Ù… ...">
              </div>
              <div class="field">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø·Ø±Ø© / Ø§Ù„Ø´Ø§Ø­Ù†Ø©</label>
                <input type="text" id="truckNumberInput" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label>Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ</label>
                <input type="text" id="statementNumberInput" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
              </div>
              <div class="field">
                <label>Ù†Ø³Ø® Ù…Ù† ÙƒØ´Ù Ø³Ø§Ø¨Ù‚ Ù„Ù†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                <button class="pill-btn pill-gray" id="copyLastEntriesBtn">
                  <span>ğŸ“‹</span> Ù†Ø³Ø® Ø¢Ø®Ø± Ø¨Ù†ÙˆØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„
                </button>
              </div>
            </div>

            <div class="section">
              <h3><span class="icon">ğŸ§®</span> Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h3>
              <small>Ø£Ø¶Ù Ø³Ø·Ø±Ù‹Ø§ Ù„ÙƒÙ„ Ø¨Ù†Ø¯: Ø§Ù„ÙˆØµÙ + Ø§Ù„Ù…Ø¨Ù„Øº + Ø§Ù„Ø¹Ù…Ù„Ø© + Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡)</small>
            </div>

            <div class="entries-header" style="display:flex;justify-content:space-between;align-items:center;margin:4px 0 6px 0;font-size:.75rem;color:#9ca3af;">
              <div>Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
              <button class="btn btn-primary" id="addEntryBtn">
                <span class="icon">â•</span> Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯
              </button>
            </div>

            <div id="entriesContainer" class="entries"></div>

            <div class="row">
              <div>
                <label>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="text" id="manualTotal" placeholder="Ù…Ø«Ø§Ù„: 2,300 Ø³Ø¹ÙˆØ¯ÙŠ + 3,326,706 ÙŠÙ…Ù†ÙŠ">
              </div>
            </div>

            <div class="row">
              <div>
                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <textarea id="extraNotes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªØ±ÙŠØ¯ Ø¸Ù‡ÙˆØ±Ù‡Ø§ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒØ´Ù"></textarea>
              </div>
            </div>

            <div class="totals-box" id="currentStatementTotals">
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ø¨Ø¹Ø¯.
            </div>

            <div class="row">
              <button class="pill-btn pill-green" id="saveStatementBtn" style="flex:1;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙƒØ´Ù</button>
              <button class="pill-btn pill-gray" id="newStatementSameClientBtn" style="flex:1;">+ ÙƒØ´Ù Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ù†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
            </div>
          </div>

          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ“²</span> Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</h2>
                <small>Ø§Ù„Ù†Øµ ÙƒÙ…Ø§ Ø³ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„ (ÙŠÙ…ÙƒÙ† Ù†Ø³Ø®Ù‡ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„)</small>
              </div>
            </div>

            <div id="whatsAppText"></div>

            <div class="whatsapp-row">
              <div class="left">
                <span class="badge-wa">
                  <span>ğŸ’¬</span> Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                </span>
                <span class="hint">Ø§Ø¶ØºØ· "Ù†Ø³Ø® Ø§Ù„Ù†Øµ" Ø«Ù… Ø§Ù„ØµÙ‚Ù‡ ÙÙŠ Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
              </div>
              <div class="actions-row">
                <button class="pill-btn" id="copyTextBtn">
                  <span>ğŸ“‹</span> Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                </button>
              </div>
            </div>

            <div class="section" style="margin-top:10px;">
              <h3><span class="icon">ğŸ–¨ï¸</span> Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ / Ù…Ø´Ø§Ø±ÙƒØ©</h3>
              <small>Ø£Ù†Ø´Ø¦ Ù†Ø³Ø®Ø© PDF Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒØ´Ù Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ ÙƒÙ†Øµ Ù…Ù†Ø³Ù‚</small>
            </div>

            <div class="surface-toolbar">
              <button class="btn" id="printPdfBtn">
                <span class="icon">ğŸ–¨ï¸</span> Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF
              </button>
              <button class="btn-ghost btn" id="shareTextBtn">
                <span class="icon">ğŸ“¤</span> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†Øµ
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ====== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ¶Ø¹: Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ===== -->
      <div id="modeClients" class="mode-panel" style="display:none;">
        <div class="grid grid-cols-2">
          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ‘¥</span> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
                <small>Ø§Ø®ØªÙØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒØ´ÙˆÙØ§ØªÙ‡ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© ÙƒØ´Ù Ø¬Ø¯ÙŠØ¯</small>
              </div>
            </div>

            <div class="clients-list-header">
              <div class="clients-search">
                <input type="text" id="clientsSearchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...">
              </div>
              <span class="badge-sm" id="clientsCountBadge">0 Ø¹Ù…ÙŠÙ„</span>
            </div>

            <div id="clientsList" class="list"></div>

            <div class="hint">
              Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ ÙƒØ´ÙˆÙØ§ØªÙ‡ØŒ Ø£Ùˆ Ù„Ø¨Ø¯Ø¡ ÙƒØ´Ù Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³Ù…Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©.
            </div>
          </div>

          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ“‚</span> ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª</h2>
                <small>Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø³Ø±ÙŠØ¹ + Ù…Ø¬Ù…ÙˆØ¹ Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡ Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©</small>
              </div>
            </div>

            <div class="stats-row" id="totalsBox">
              <!-- ØªÙÙ…Ù„Ø£ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§ -->
            </div>

            <div class="section">
              <h3><span class="icon">ğŸ“œ</span> Ø§Ù„ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„</h3>
              <small>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ ÙƒØ´Ù Ù„Ø¹Ø±Ø¶Ù‡ Ø£Ùˆ Ù†Ø³Ø®Ù‡ Ø£Ùˆ ÙØªØ­Ù‡ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</small>
            </div>

            <div id="statementsList" class="list"></div>
          </div>
        </div>
      </div>

      <!-- ====== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ¶Ø¹: Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ===== -->
      <div id="modeReports" class="mode-panel" style="display:none;">
        <div class="grid grid-cols-2">
          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ“Š</span> ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø§Ø¨ Ø¹Ù…ÙŠÙ„</h2>
                <small>Ø§Ø­Ø³Ø¨ "Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡" Ù…Ø¹ Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„ÙØªØ±Ø©</small>
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                <select id="reportClientSelect"></select>
              </div>
              <div class="field">
                <label>Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <div style="display:flex;gap:4px;align-items:center;">
                  <input type="date" id="reportFrom" style="flex:1;">
                  <span style="font-size:.7rem;color:#9ca3af;">Ø¥Ù„Ù‰</span>
                  <input type="date" id="reportTo" style="flex:1;">
                </div>
              </div>
            </div>

            <div class="surface-toolbar">
              <button class="btn btn-primary" id="buildReportBtn">
                <span class="icon">ğŸ“ˆ</span> Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button>
              <button class="btn-ghost btn" id="clearReportBtn">
                <span class="icon">ğŸ§¹</span> Ù…Ø³Ø­ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
              </button>
            </div>

            <div class="hint">
              ÙŠÙ…ÙƒÙ† Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£Ùˆ Ù†Ø³Ø®Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±.
            </div>
          </div>

          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ“œ</span> Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h2>
                <small>Ù…Ù„Ø®Øµ Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡ Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø© + Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØªØ±Ø©</small>
              </div>
            </div>

            <div id="reportBox" class="totals-box">
              Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯.
            </div>

            <div class="surface-toolbar" style="margin-top:8px;">
              <button class="btn" id="copyReportBtn">
                <span class="icon">ğŸ“‹</span> Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ†Øµ
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ====== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ¶Ø¹: Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ ===== -->
      <div id="modeVoice" class="mode-panel" style="display:none;">
        <div class="grid grid-cols-2">
          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ™ï¸</span> Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø³Ù‘Ø§Ù… Ø§Ù„ØµÙˆØªÙŠ</h2>
                <small>ØªÙƒÙ„Ù‘Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØŒ ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙŠØ­Ø§ÙˆÙ„ ÙÙ‡Ù… Ø·Ù„Ø¨Ùƒ ÙˆØªÙ†ÙÙŠØ°Ù‡ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ´ÙˆÙ</small>
              </div>
            </div>

            <div class="section">
              <h3><span class="icon">ğŸ’¡</span> Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ù…Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù‚ÙˆÙ„Ù‡</h3>
              <div class="intents-row">
                <div class="intent-pill">
                  <span class="dot action"></span>
                  "Ø§ÙØªØ­ ÙƒØ´Ù Ø¬Ø¯ÙŠØ¯ Ù„Ø£Ø­Ù…Ø¯ Ø§Ù„ÙŠÙˆÙ…"
                </div>
                <div class="intent-pill">
                  <span class="dot query"></span>
                  "ÙƒÙ… Ù„Ù‡ Ø£Ø­Ù…Ø¯ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØŸ"
                </div>
                <div class="intent-pill">
                  <span class="dot smalltalk"></span>
                  "Ø´ÙƒØ±Ø§Ù‹ ÙŠØ§ Ø¨Ø³Ù‘Ø§Ù…"
                </div>
              </div>
            </div>

            <div style="margin-top:10px;display:flex;flex-direction:column;gap:6px;">
              <button class="pill-btn pill-green" id="startVoiceBtn">
                <span>ğŸ™ï¸</span> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
              </button>
              <button class="pill-btn pill-gray" id="stopVoiceBtn">
                <span>ğŸ›‘</span> Ø¥ÙŠÙ‚Ø§Ù
              </button>

              <div class="voice-status">
                <div>
                  <span id="voiceStatusDot" class="dot idle"></span>
                  <span id="voiceStatusText">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.</span>
                </div>
                <span class="badge-small" id="lastSourceBadge">Ø§Ù„Ù…Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ: â€”</span>
              </div>
            </div>

            <div class="section">
              <h3><span class="icon">ğŸ§ </span> ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯</h3>
              <small>Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©ØŒ Ø§Ù„Ù…Ø²Ø§Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØŒ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</small>
            </div>

            <div class="stats-row" id="voiceBadgesRow">
              <span class="badge-intent" id="intentBadge">Ø§Ù„Ù†ÙŠØ©: â€”</span>
              <span class="badge-sentiment" id="sentimentBadge">Ø§Ù„Ù…Ø²Ø§Ø¬: â€”</span>
              <span class="badge-source" id="sourceBadge">Ø§Ù„Ù…ØµØ¯Ø±: â€”</span>
            </div>

            <div class="section" style="margin-top:10px;">
              <h3><span class="icon">ğŸ“œ</span> Ø¢Ø®Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØµÙˆØªÙŠØ©</h3>
              <small>Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø£ÙˆØ§Ù…Ø± Ø³Ø§Ø¨Ù‚Ø©</small>
            </div>

            <div id="voiceHistoryList" class="history-list"></div>
          </div>

          <div class="surface">
            <div class="surface-header">
              <div>
                <h2><span>ğŸ“¥</span> Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªÙ„Ù… Ù…Ù† Ø§Ù„ØµÙˆØª</h2>
                <small>Ù…Ø§ Ø³Ù…Ø¹Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ù…Ù† ÙƒÙ„Ø§Ù…Ùƒ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„</small>
              </div>
            </div>

            <textarea id="voiceRawText" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ø§ØªØ¬ Ù…Ù† ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ..." style="min-height:80px;"></textarea>

            <div class="section" style="margin-top:10px;">
              <h3><span class="icon">ğŸ§¾</span> ØªÙØ³ÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù„Ø£Ù…Ø±</h3>
              <small>ÙƒÙŠÙ ÙÙ‡Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø·Ù„Ø¨ÙƒØŒ ÙˆÙ…Ø§ Ù‡ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</small>
            </div>

            <textarea id="voiceInterpretation" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ù„Ø®Øµ Ù„Ù„Ù†ÙŠØ© ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙŠ Ø³ÙŠØªØ®Ø°Ù‡Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚..." style="min-height:100px;"></textarea>

            <div class="surface-toolbar" style="margin-top:8px;">
              <button class="btn btn-primary" id="applyVoiceActionBtn">
                <span class="icon">âš™ï¸</span> ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­
              </button>
              <button class="btn-ghost btn" id="clearVoiceUiBtn">
                <span class="icon">ğŸ§¹</span> Ù…Ø³Ø­ Ø§Ù„Ø¹Ø±Ø¶
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªÙØ­ÙØ¸ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· (LocalStorage). ÙŠÙØ¶Ù‘Ù„ Ø£Ø®Ø° Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¯ÙˆØ±ÙŠÙ‹Ø§.
        |
        Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø¹Ø¯Ù„Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ø¨Ø³Ù‘Ø§Ù… ÙˆÙ…Ø³Ø§Ø¹Ø¯Ù‡ Ø§Ù„Ø°ÙƒÙŠ.
      </div>
    </div>
  </div>

  <script>
    // ====== Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© =====
    const state = {
      data: {
        clients: {}
      },
      currentClient: null,
      currentStatementId: null,
      lastUsedClientName: null,
      voiceHistory: []
    };

    // ====== Ø¹Ù†Ø§ØµØ± DOM Ø£Ø³Ø§Ø³ÙŠØ© =====
    const clientNameInput       = document.getElementById("clientNameInput");
    const dateInput             = document.getElementById("dateInput");
    const titleInput            = document.getElementById("titleInput");
    const truckNumberInput      = document.getElementById("truckNumberInput");
    const statementNumberInput  = document.getElementById("statementNumberInput");
    const manualTotalInput      = document.getElementById("manualTotal");
    const extraNotesInput       = document.getElementById("extraNotes");
    const entriesContainer      = document.getElementById("entriesContainer");
    const whatsAppBox          = document.getElementById("whatsAppText");
    const statementsListEl     = document.getElementById("statementsList");
    const totalsBoxEl          = document.getElementById("totalsBox");
    const currentStatementTotalsEl = document.getElementById("currentStatementTotals");
    const clientsListEl        = document.getElementById("clientsList");
    const clientsSearchInput   = document.getElementById("clientsSearchInput");
    const clientsCountBadge    = document.getElementById("clientsCountBadge");
    const reportClientSelect   = document.getElementById("reportClientSelect");
    const reportFromInput      = document.getElementById("reportFrom");
    const reportToInput        = document.getElementById("reportTo");
    const reportBox            = document.getElementById("reportBox");

    const voiceStatusDot       = document.getElementById("voiceStatusDot");
    const voiceStatusText      = document.getElementById("voiceStatusText");
    const voiceRawText         = document.getElementById("voiceRawText");
    const voiceInterpretation  = document.getElementById("voiceInterpretation");
    const voiceHistoryList     = document.getElementById("voiceHistoryList");
    const intentBadge          = document.getElementById("intentBadge");
    const sentimentBadge       = document.getElementById("sentimentBadge");
    const sourceBadge          = document.getElementById("sourceBadge");
    const lastSourceBadge      = document.getElementById("lastSourceBadge");
    const voiceBadgesRow       = document.getElementById("voiceBadgesRow");

    // ====== ØªØ­Ù…ÙŠÙ„ / Ø­ÙØ¸ Ø¥Ù„Ù‰ LocalStorage =====
    function loadData(){
      try {
        const raw = localStorage.getItem("voice-ledger-data");
        if(!raw) return;
        const obj = JSON.parse(raw);
        if(obj && obj.clients) {
          state.data.clients = obj.clients;
        }
      } catch(e) {
        console.error("Error loading data", e);
      }
    }

    function saveData(){
      try {
        localStorage.setItem("voice-ledger-data", JSON.stringify({clients: state.data.clients}));
      } catch(e) {
        console.error("Error saving data", e);
      }
    }

    // ====== Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯ =====
    function createEntryRow(initial){
      const row = document.createElement("div");
      row.className = "entry-row";

      row.innerHTML = `
        <input type="text" class="entry-desc" placeholder="Ø§Ù„ÙˆØµÙ (Ù…Ø«Ø§Ù„: Ø¬Ù…Ø±Ùƒ Ø´Ø­Ù†ØŒ ØªØ­Ù…ÙŠÙ„ØŒ Ø£ØªØ¹Ø§Ø¨ ØªØ®Ù„ÙŠØµ)">
        <input type="number" class="entry-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01">
        <select class="entry-curr">
          <option value="Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
          <option value="Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
          <option value="Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ">Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ</option>
          <option value="Ø¯ÙˆÙ„Ø§Ø±">Ø¯ÙˆÙ„Ø§Ø±</option>
        </select>
        <select class="entry-dir">
          <option value="Ù„Ù‡">Ù„Ù‡</option>
          <option value="Ø¹Ù„ÙŠÙ‡">Ø¹Ù„ÙŠÙ‡</option>
        </select>
        <button class="btn btn-icon-only" title="Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ø¯">ğŸ—‘ï¸</button>
      `;

      const descInput   = row.querySelector(".entry-desc");
      const amountInput = row.querySelector(".entry-amount");
      const currSelect  = row.querySelector(".entry-curr");
      const dirSelect   = row.querySelector(".entry-dir");
      const deleteBtn   = row.querySelector("button");

      if(initial){
        descInput.value   = initial.desc || "";
        amountInput.value = initial.amount || "";
        currSelect.value  = initial.currency || "Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ";
        dirSelect.value   = initial.direction || "Ù„Ù‡";
      }

      descInput.addEventListener("input", updatePreviewText);
      amountInput.addEventListener("input", updatePreviewText);
      currSelect.addEventListener("change", updatePreviewText);
      dirSelect.addEventListener("change", updatePreviewText);

      deleteBtn.addEventListener("click", ()=>{
        row.remove();
        updatePreviewText();
      });

      return row;
    }

    function addEntryRow(initial){
      const row = createEntryRow(initial);
      entriesContainer.appendChild(row);
    }

    // ====== Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙƒÙƒØ§Ø¦Ù†Ø§Øª =====
    function getEntries(){
      return [...entriesContainer.querySelectorAll(".entry-row")].map(r=>{
        const amountRaw = (r.querySelector(".entry-amount").value || "").replace(/,/g,"");
        return {
          desc:      r.querySelector(".entry-desc").value.trim(),
          amount:    +amountRaw || 0,
          currency:  r.querySelector(".entry-curr").value,
          direction: r.querySelector(".entry-dir").value
        };
      }).filter(e=>e.desc || e.amount);
    }

    function computeTotalsForEntries(entries){
      const totals = {};
      entries.forEach(e => {
        if (!e.currency) return;
        if (!totals[e.currency]) {
          totals[e.currency] = { lah: 0, alaih: 0 };
        }
        if (e.direction === "Ù„Ù‡") {
          totals[e.currency].lah += e.amount;
        } else {
          totals[e.currency].alaih += e.amount;
        }
      });
      return totals;
    }

    function renderCurrentStatementTotals(){
      if (!currentStatementTotalsEl) return;

      const entries = getEntries();
      const totals  = computeTotalsForEntries(entries);

      if (!Object.keys(totals).length) {
        currentStatementTotalsEl.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ø¨Ø¹Ø¯.";
        return;
      }

      let txt = "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒØ´Ù:\n";
      Object.keys(totals).forEach(c => {
        const t    = totals[c];
        const diff = t.lah - t.alaih;
        const dir  = diff > 0 ? "Ù„Ù‡" : (diff < 0 ? "Ø¹Ù„ÙŠÙ‡" : "Ù„Ø§ Ø´ÙŠØ¡");

        txt += `${c}:\n` +
               `Ù„Ù‡: ${t.lah.toLocaleString("en-US")}\n` +
               `Ø¹Ù„ÙŠÙ‡: ${t.alaih.toLocaleString("en-US")}\n` +
               `Ø§Ù„ØµØ§ÙÙŠ: ${Math.abs(diff).toLocaleString("en-US")} (${dir})\n\n`;
      });

      currentStatementTotalsEl.textContent = txt;
    }

        function ensureClient(n){
      if(!state.data.clients[n]) state.data.clients[n] = {statements:[]};
    }

    function saveCurrentStatement(){
      const name = clientNameInput.value.trim();
      if(!name){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"); return; }
      ensureClient(name);
      const st = {
        id: state.currentStatementId || Date.now(),
        date: dateInput.value || new Date().toISOString().slice(0,10),
        title: titleInput.value,
        truckNumber: truckNumberInput.value,
        statementNumber: statementNumberInput.value,
        entries: getEntries(),
        manualTotal: manualTotalInput.value,
        extraNotes: extraNotesInput.value
      };
      if(!st.entries.length){
        if(!confirm("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø§Ù„ÙƒØ´ÙØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) return;
      }
      const arr = state.data.clients[name].statements;
      if(state.currentStatementId){
        const idx = arr.findIndex(s=>s.id === state.currentStatementId);
        if(idx>=0) arr[idx] = st;
      } else {
        arr.push(st);
      }
      state.lastUsedClientName = name;
      saveData();
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙƒØ´Ù.");
      renderClientsList();
      renderStatementsForClient(name);
      renderReportClientsOptions();
    }

    // ====== Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ´ÙˆÙ ÙˆØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„ =====
    function renderStatementsForClient(name){
      state.currentClient = name;
      const client = state.data.clients[name];
      statementsListEl.innerHTML = "";
      if(!client || !client.statements.length){
        statementsListEl.innerHTML = `<div class="list-item"><span>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØ´ÙˆÙØ§Øª Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.</span></div>`;
        totalsBoxEl.innerHTML = "";
        return;
      }

      client.statements
        .slice()
        .sort((a,b)=> (a.date||"") < (b.date||"") ? 1 : -1)
        .forEach(st=>{
          const div = document.createElement("div");
          div.className = "list-item";
          const total = computeTotalsForStatement(st);
          const summary = summarizeTotalsPerCurrency(total);
          div.innerHTML = `
            <div>
              <div>${st.title || "ÙƒØ´Ù Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</div>
              <div class="meta">
                <span class="badge-date">ğŸ“… ${st.date || "-"}</span>
                ${st.truckNumber ? `<span class="badge-small">ğŸšš ${st.truckNumber}</span>` : ""}
                ${st.statementNumber ? `<span class="badge-small">ğŸ“„ Ø¨ÙŠØ§Ù†: ${st.statementNumber}</span>` : ""}
              </div>
            </div>
            <div style="text-align:left;">
              <div class="badge-amount">${summary}</div>
            </div>
          `;
          div.addEventListener("click", ()=>{
            loadStatementIntoForm(name, st.id);
          });
          statementsListEl.appendChild(div);
        });

      renderTotalsForCurrentClient();
    }

    function computeTotalsForStatement(st){
      const totals = {};
      (st.entries || []).forEach(e=>{
        if(!e.currency) return;
        if(!totals[e.currency]) totals[e.currency] = {lah:0, alaih:0};
        if(e.direction==="Ù„Ù‡") totals[e.currency].lah += e.amount||0;
        else                   totals[e.currency].alaih += e.amount||0;
      });
      return totals;
    }

    function summarizeTotalsPerCurrency(totals){
      const parts = [];
      Object.keys(totals).forEach(c=>{
        const lah   = totals[c].lah;
        const alaih = totals[c].alaih;
        const diff  = lah - alaih;
        const dir   = diff>0 ? "Ù„Ù‡" : diff<0 ? "Ø¹Ù„ÙŠÙ‡" : "Ù…ØªØ²Ù†";
        parts.push(`${c}: ${Math.abs(diff).toLocaleString("en-US")} (${dir})`);
      });
      return parts.join(" | ");
    }

    function renderTotalsForCurrentClient(){
      if(!state.currentClient || !state.data.clients[state.currentClient]){
        totalsBoxEl.innerHTML = "";
        return;
      }
      const arr = state.data.clients[state.currentClient].statements || [];
      if(!arr.length){
        totalsBoxEl.innerHTML = "";
        return;
      }
      const agg = {};
      arr.forEach(st=>{
        (st.entries||[]).forEach(e=>{
          if(!e.currency) return;
          if(!agg[e.currency]) agg[e.currency] = {lah:0, alaih:0};
          if(e.direction==="Ù„Ù‡") agg[e.currency].lah += e.amount||0;
          else                   agg[e.currency].alaih += e.amount||0;
        });
      });
      totalsBoxEl.innerHTML = "";
      Object.keys(agg).forEach(c=>{
        const pill = document.createElement("div");
        pill.className = "stat-pill";
        const lah   = agg[c].lah;
        const alaih = agg[c].alaih;
        const diff  = lah - alaih;
        const dir   = diff>0 ? "Ù„Ù‡" : diff<0 ? "Ø¹Ù„ÙŠÙ‡" : "Ù…ØªØ²Ù†";
        pill.innerHTML = `
          <span class="label">${c}:</span>
          <span>${Math.abs(diff).toLocaleString("en-US")}</span>
          <span style="opacity:.8;">(${dir})</span>
        `;
        totalsBoxEl.appendChild(pill);
      });
    }

    function loadStatementIntoForm(name, id){
      const client = state.data.clients[name];
      if(!client) return;
      const st = client.statements.find(s=>s.id===id);
      if(!st) return;
      document.querySelector('[data-mode="statements"]').click();
      clientNameInput.value       = name;
      dateInput.value             = st.date || "";
      titleInput.value            = st.title || "";
      truckNumberInput.value      = st.truckNumber || "";
      statementNumberInput.value  = st.statementNumber || "";
      manualTotalInput.value      = st.manualTotal || "";
      extraNotesInput.value       = st.extraNotes || "";
      entriesContainer.innerHTML  = "";
      (st.entries || []).forEach(e=> addEntryRow(e));
      if(!st.entries || !st.entries.length){
        addEntryRow();
      }
      state.currentStatementId = st.id;
      updatePreviewText();
    }

    // ====== Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ =====
    function renderClientsList(){
      const names = Object.keys(state.data.clients).sort();
      clientsListEl.innerHTML = "";
      const search = (clientsSearchInput.value || "").trim();
      const filtered = names.filter(n => !search || n.includes(search));
      clientsCountBadge.textContent = `${filtered.length} Ø¹Ù…ÙŠÙ„`;
      if(!filtered.length){
        clientsListEl.innerHTML = `<div class="list-item"><span>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø·Ø§Ø¨Ù‚ÙˆÙ† Ù„Ø¨Ø­Ø«Ùƒ.</span></div>`;
        return;
      }
      filtered.forEach(name=>{
        const div = document.createElement("div");
        div.className = "list-item";
        const stCount = (state.data.clients[name].statements || []).length;
        div.innerHTML = `
          <div>
            <div>${name}</div>
            <div class="meta">${stCount} ÙƒØ´Ù/ÙƒØ´ÙˆÙ</div>
          </div>
          <div>
            <button class="pill-btn pill-gray" data-name="${name}">ÙØªØ­</button>
          </div>
        `;
        div.querySelector("button").addEventListener("click", ()=>{
          clientNameInput.value = name;
          state.currentStatementId = null;
          state.currentClient = name;
          renderStatementsForClient(name);
          document.querySelector('[data-mode="statements"]').click();
        });
        clientsListEl.appendChild(div);
      });
    }

    function renderReportClientsOptions(){
      const names = Object.keys(state.data.clients).sort();
      reportClientSelect.innerHTML = `<option value="">â€” Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ â€”</option>`;
      names.forEach(n=>{
        const opt = document.createElement("option");
        opt.value = n;
        opt.textContent = n;
        reportClientSelect.appendChild(opt);
      });
    }

    // ====== ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡ ÙÙŠ Ø§Ù„ÙØªØ±Ø©) =====
    function computeTotalsForClient(name, from, to){
      const client = state.data.clients[name];
      if(!client) return {};
      const fromDate = from ? new Date(from) : null;
      const toDate   = to   ? new Date(to)   : null;
      const agg = {};
      client.statements.forEach(st=>{
        const stDate = st.date ? new Date(st.date) : null;
        if(fromDate && stDate && stDate < fromDate) return;
        if(toDate   && stDate && stDate > toDate)   return;
        (st.entries || []).forEach(e=>{
          if(!e.currency) return;
          if(!agg[e.currency]) agg[e.currency] = {lah:0, alaih:0};
          if(e.direction==="Ù„Ù‡") agg[e.currency].lah   += e.amount||0;
          else                   agg[e.currency].alaih += e.amount||0;
        });
      });
      return agg;
    }

    function buildReport(){
      const name = reportClientSelect.value;
      if (!name) { alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹"); return; }

      const from = reportFromInput.value;
      const to   = reportToInput.value;

      // Ù†Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡ Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©) Ù„Ù„ÙØªØ±Ø©
      const totals = computeTotalsForClient(name, from, to);
      if (!Object.keys(totals).length) {
        reportBox.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.";
        return;
      }

      // Ù†Ø­Ø³Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ´ÙˆÙ ÙˆØ£Ù‚Ø¯Ù…/Ø£Ø­Ø¯Ø« ØªØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„ÙØªØ±Ø©
      let statementsCount = 0;
      let firstDate = null;
      let lastDate  = null;

      const client = state.data.clients[name];
      if (client && Array.isArray(client.statements)) {
        const fromDateObj = from ? new Date(from) : null;
        const toDateObj   = to   ? new Date(to)   : null;

        client.statements.forEach(s => {
          let inRange = true;
          if (fromDateObj || toDateObj) {
            const sd = s.date ? new Date(s.date) : null;
            if (sd) {
              if (fromDateObj && sd < fromDateObj) inRange = false;
              if (toDateObj   && sd > toDateObj)   inRange = false;
            }
          }
          if (!inRange) return;

          statementsCount++;
          if (s.date) {
            if (!firstDate || s.date < firstDate) firstDate = s.date;
            if (!lastDate  || s.date > lastDate)  lastDate  = s.date;
          }
        });
      }

      let header = `ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}\n`;
      if (from || to) {
        header += `Ø§Ù„ÙØªØ±Ø©: ${from || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"} Ø¥Ù„Ù‰ ${to || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}\n`;
      }
      if (statementsCount > 0) {
        header += `Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ´ÙˆÙ ÙÙŠ Ø§Ù„ÙØªØ±Ø©: ${statementsCount}\n`;
        if (firstDate || lastDate) {
          header += `Ù…Ù† Ø£Ù‚Ø¯Ù… ÙƒØ´Ù Ø¨ØªØ§Ø±ÙŠØ®: ${firstDate || "-"} Ø¥Ù„Ù‰ Ø£Ø­Ø¯Ø« ÙƒØ´Ù Ø¨ØªØ§Ø±ÙŠØ®: ${lastDate || "-"}\n`;
        }
      }
      header += "------------------------\n";

      let body = "";
      Object.keys(totals).forEach(c => {
        const lah   = totals[c].lah;
        const alaih = totals[c].alaih;
        const diff  = lah - alaih;
        const dir   = diff > 0 ? "Ù„Ù‡" : (diff < 0 ? "Ø¹Ù„ÙŠÙ‡" : "Ù„Ø§ Ø´ÙŠØ¡");

        body += `${c}:\n` +
                `Ù„Ù‡: ${lah.toLocaleString("en-US")}\n` +
                `Ø¹Ù„ÙŠÙ‡: ${alaih.toLocaleString("en-US")}\n` +
                `Ø§Ù„ØµØ§ÙÙŠ: ${Math.abs(diff).toLocaleString("en-US")} (${dir})\n\n`;
      });

      reportBox.textContent = header + body;
    }

    // ====== Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Øµ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ =====
    function updatePreviewText(){
      const n   = clientNameInput.value.trim() || "Ø§Ù„Ø¹Ù…ÙŠÙ„";
      const d   = dateInput.value || "";
      const ti  = titleInput.value || "";
      const trk = truckNumberInput.value.trim();
      const stn = statementNumberInput.value.trim();

      let txt = `${n}\nØ§Ù„ØªØ§Ø±ÙŠØ®: ${d}\n----------------\n${ti}`;
      if (trk) txt += `\nØ±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø·Ø±Ø©: ${trk}`;
      if (stn) txt += `\nØ±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ§Ù†: ${stn}`;
      txt += "\n";

      const entries = getEntries();

      // Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø³Ø·Ø± Ø¨Ø³Ø·Ø±
      entries.forEach((e, i) => {
        txt += `\n${i+1}- ${e.desc} ${e.amount.toLocaleString("en-US")} ${e.currency} (${e.direction})`;
      });

      // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒØ´Ù Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©
      const totals = computeTotalsForEntries(entries);
      if (Object.keys(totals).length) {
        txt += `\n\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒØ´Ù:\n`;
        Object.keys(totals).forEach(c => {
          const t    = totals[c];
          const diff = t.lah - t.alaih;
          const dir  = diff > 0 ? "Ù„Ù‡" : (diff < 0 ? "Ø¹Ù„ÙŠÙ‡" : "Ù„Ø§ Ø´ÙŠØ¡");

          txt += `${c}: Ù„Ù‡ ${t.lah.toLocaleString("en-US")} - Ø¹Ù„ÙŠÙ‡ ${t.alaih.toLocaleString("en-US")} = Ø§Ù„ØµØ§ÙÙŠ ${Math.abs(diff).toLocaleString("en-US")} (${dir})\n`;
        });
      }

      // Ù„Ùˆ ÙƒØªØ¨Øª Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙŠØ¯ÙˆÙŠ
      if (manualTotalInput.value) {
        txt += `\n\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (ÙŠØ¯ÙˆÙŠ): ${manualTotalInput.value}`;
      }

      // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
      if (extraNotesInput.value) {
        txt += `\n\nÙ…Ù„Ø§Ø­Ø¸Ø§Øª:\n${extraNotesInput.value}`;
      }

      whatsAppBox.textContent = txt;

      // ØªØ­Ø¯ÙŠØ« ØµÙ†Ø¯ÙˆÙ‚ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ´Ù ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
      renderCurrentStatementTotals();
    }

    // ====== Ø¨Ù†Ø§Ø¡ Ø¨Ù„ÙˆÙƒ HTML Ù„ÙƒØ´Ù ÙˆØ§Ø­Ø¯ (Ù†Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ PDF) =====
    function buildStatementHtml(st){
      const totals = computeTotalsForStatement(st);
      const summary = summarizeTotalsPerCurrency(totals);
      const entriesHtml = (st.entries||[]).map((e,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${e.desc || ""}</td>
          <td>${e.amount ? e.amount.toLocaleString("en-US") : ""}</td>
          <td>${e.currency || ""}</td>
          <td>${e.direction || ""}</td>
        </tr>
      `).join("");

      return `
        <div style="margin-bottom:24px;">
          <h2 style="margin:0 0 4px 0;font-size:16px;">${st.title || "ÙƒØ´Ù Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</h2>
          <div style="font-size:13px;color:#4b5563;">
            <span>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${st.date || "-"}</span>
            ${st.truckNumber ? `<span style="margin-inline:10px;">| Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø·Ø±Ø©: ${st.truckNumber}</span>` : ""}
            ${st.statementNumber ? `<span>| Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ§Ù†: ${st.statementNumber}</span>` : ""}
          </div>
          <table style="width:100%;border-collapse:collapse;margin-top:8px;font-size:13px;">
            <thead>
              <tr>
                <th style="border:1px solid #e5e7eb;padding:4px;">#</th>
                <th style="border:1px solid #e5e7eb;padding:4px;">Ø§Ù„Ø¨Ù†Ø¯</th>
                <th style="border:1px solid #e5e7eb;padding:4px;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                <th style="border:1px solid #e5e7eb;padding:4px;">Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                <th style="border:1px solid #e5e7eb;padding:4px;">Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡</th>
              </tr>
            </thead>
            <tbody>
              ${entriesHtml || `<tr><td colspan="5" style="border:1px solid #e5e7eb;padding:4px;text-align:center;color:#6b7280;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯</td></tr>`}
            </tbody>
          </table>
          <div style="margin-top:6px;font-size:13px;color:#111827;">
            <strong>Ù…Ù„Ø®Øµ Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©:</strong> ${summary || "â€”"}
          </div>
          ${st.manualTotal ? `<div style="margin-top:4px;font-size:13px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (ÙƒÙ…Ø§ Ø£Ø¯Ø®Ù„ØªÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹): ${st.manualTotal}</div>` : ""}
          ${st.extraNotes ? `<div style="margin-top:4px;font-size:13px;white-space:pre-wrap;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:\n${st.extraNotes}</div>` : ""}
        </div>
      `;
    }

    // ====== Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF =====
    function printCurrentStatementAsPdf(){
      const name = clientNameInput.value.trim() || "Ø§Ù„Ø¹Ù…ÙŠÙ„";
      const st = {
        date: dateInput.value || "",
        title: titleInput.value || "",
        truckNumber: truckNumberInput.value || "",
        statementNumber: statementNumberInput.value || "",
        entries: getEntries(),
        manualTotal: manualTotalInput.value,
        extraNotes: extraNotesInput.value
      };

      const html = `
        <html lang="ar" dir="rtl">
        <head>
          <meta charset="utf-8"/>
          <title>ÙƒØ´Ù Ù…ØµØ±ÙˆÙØ§Øª - ${name}</title>
          <style>
            body {
              font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
              padding: 16px;
              color: #111827;
            }
            h1 {
              margin-top: 0;
              font-size: 18px;
            }
          </style>
        </head>
        <body>
          <h1>ÙƒØ´Ù Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}</h1>
          ${buildStatementHtml(st)}
        </body>
        </html>
      `;

      const w = window.open("", "_blank");
      w.document.write(html);
      w.document.close();
      w.focus();
      w.print();
    }

    // ====== Ø£ÙˆØ§Ù…Ø± Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù…Ø³Ø­ ÙˆØ¥Ù†Ø´Ø§Ø¡ ÙƒØ´Ù Ø¬Ø¯ÙŠØ¯ =====
    function resetForm(keepName){
      state.currentStatementId = null;
      if(keepName) clientNameInput.value = keepName;
      dateInput.value        = new Date().toISOString().slice(0,10);
      titleInput.value       = "";
      truckNumberInput.value = "";
      statementNumberInput.value = "";
      manualTotalInput.value = "";
      extraNotesInput.value  = "";
      entriesContainer.innerHTML = "";
      addEntryRow();
      updatePreviewText();
      renderCurrentStatementTotals();
      renderStatementsList();
      renderTotalsForCurrentClient();
    }

    function copyLastEntries(){
      const name = clientNameInput.value.trim();
      if(!name || !state.data.clients[name] || !state.data.clients[name].statements.length){
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØ´ÙˆÙØ§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.");
        return;
      }
      const last = state.data.clients[name].statements[state.data.clients[name].statements.length-1];
      entriesContainer.innerHTML = "";
      (last.entries||[]).forEach(e => addEntryRow(e));
      if(!last.entries || !last.entries.length){
        addEntryRow();
      }
      updatePreviewText();
    }

    // ====== Ù†Ø³Ø® Ø§Ù„Ù†Øµ / Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© =====
    async function copyWhatsAppText(){
      try {
        await navigator.clipboard.writeText(whatsAppBox.textContent || "");
        alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ. Ø§Ù„ØµÙ‚Ù‡ ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.");
      } catch(e) {
        alert("ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ ÙˆÙ†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§.");
      }
    }

    async function shareWhatsAppText(){
      const text = whatsAppBox.textContent || "";
      if(navigator.share){
        try {
          await navigator.share({text});
        } catch(e) {
          console.error(e);
        }
      } else {
        await copyWhatsAppText();
      }
    }

    // ====== ØªÙ‚Ø§Ø±ÙŠØ±: Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± =====
    async function copyReportText(){
      try {
        await navigator.clipboard.writeText(reportBox.textContent || "");
        alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±.");
      } catch(e) {
        alert("ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆÙ†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§.");
      }
    }

    // ====== Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Tabs) =====
    function setupTabs(){
      const tabs = document.querySelectorAll("#modeTabs .tab");
      tabs.forEach(tab=>{
        tab.addEventListener("click", ()=>{
          tabs.forEach(t=>t.classList.remove("active"));
          tab.classList.add("active");
          const mode = tab.getAttribute("data-mode");
          document.querySelectorAll(".mode-panel").forEach(p=>p.style.display="none");
          document.getElementById("mode" + mode.charAt(0).toUpperCase()+mode.slice(1)).style.display = "";
        });
      });
    }

    // ====== Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ =====
    function setupClientsSearch(){
      clientsSearchInput.addEventListener("input", renderClientsList);
    }

    // ====== Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯) =====
    async function exportBackup(){
      const dataStr = JSON.stringify({clients: state.data.clients}, null, 2);
      const blob = new Blob([dataStr], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "voice-ledger-backup.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    async function importBackup(){
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = (e)=>{
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          try {
            const obj = JSON.parse(reader.result);
            if(obj && obj.clients){
              if(!confirm("Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) return;
              state.data.clients = obj.clients;
              saveData();
              renderClientsList();
              renderReportClientsOptions();
              alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©.");
            } else {
              alert("Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ ØµØ§Ù„Ø­Ø©.");
            }
          } catch(e) {
            alert("ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚.");
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // ====== Ø£Ø²Ø±Ø§Ø± ÙˆØ£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© =====
    document.getElementById("addEntryBtn").addEventListener("click", ()=>{ addEntryRow(); updatePreviewText(); });
    document.getElementById("saveStatementBtn").addEventListener("click", saveCurrentStatement);
    document.getElementById("newStatementSameClientBtn").addEventListener("click", ()=>{
      const keepName = clientNameInput.value.trim();
      resetForm(keepName);
    });
    document.getElementById("copyLastClientBtn").addEventListener("click", ()=>{
      if(state.lastUsedClientName){
        clientNameInput.value = state.lastUsedClientName;
        renderStatementsForClient(state.lastUsedClientName);
      } else {
        alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…ÙŠÙ„ Ø³Ø§Ø¨Ù‚ Ø¨Ø¹Ø¯.");
      }
    });
    document.getElementById("todayBtn").addEventListener("click", ()=>{
      dateInput.value = new Date().toISOString().slice(0,10);
      updatePreviewText();
    });
    document.getElementById("copyLastEntriesBtn").addEventListener("click", copyLastEntries);
    document.getElementById("copyTextBtn").addEventListener("click", copyWhatsAppText);
    document.getElementById("shareTextBtn").addEventListener("click", shareWhatsAppText);
    document.getElementById("printPdfBtn").addEventListener("click", printCurrentStatementAsPdf);

    document.getElementById("buildReportBtn").addEventListener("click", buildReport);
    document.getElementById("clearReportBtn").addEventListener("click", ()=>{
      reportBox.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯.";
    });
    document.getElementById("copyReportBtn").addEventListener("click", copyReportText);

    // ====== Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø¯Ø®Ù„Ø§Øª =====
    clientNameInput.addEventListener("input", updatePreviewText);
    dateInput.addEventListener("change", updatePreviewText);
    titleInput.addEventListener("input", updatePreviewText);
    truckNumberInput.addEventListener("input", updatePreviewText);
    statementNumberInput.addEventListener("input", updatePreviewText);
    manualTotalInput.addEventListener("input", updatePreviewText);
    extraNotesInput.addEventListener("input", updatePreviewText);

    // ====== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø£Ø²Ø±Ø§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„) =====
    (function setupBackupButtons(){
      const backupRow = document.createElement("div");
      backupRow.className = "section";
      backupRow.innerHTML = `
        <h3><span class="icon">ğŸ’¾</span> Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
        <small>ØªØµØ¯ÙŠØ± Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙƒØ´ÙˆÙ</small>
        <div class="surface-toolbar" style="margin-top:6px;">
          <button class="btn" id="exportBackupBtn"><span class="icon">â¬‡ï¸</span> ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
          <button class="btn-ghost btn" id="importBackupBtn"><span class="icon">â¬†ï¸</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
        </div>
      `;
      document.getElementById("modeClients").querySelector(".surface").appendChild(backupRow);
      document.getElementById("exportBackupBtn").addEventListener("click", exportBackup);
      document.getElementById("importBackupBtn").addEventListener("click", importBackup);
    })();

    // ====== Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø·) =====
    function setVoiceStatus(active, text){
      if(active){
        voiceStatusDot.classList.remove("idle");
        voiceStatusDot.classList.add("active");
        voiceStatusText.textContent = text || "ÙŠØ³ØªÙ…Ø¹ Ø§Ù„Ø¢Ù†...";
      } else {
        voiceStatusDot.classList.remove("active");
        voiceStatusDot.classList.add("idle");
        voiceStatusText.textContent = text || "Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.";
      }
    }

    function updateVoiceBadges(info){
      if(!info){
        intentBadge.textContent    = "Ø§Ù„Ù†ÙŠØ©: â€”";
        sentimentBadge.textContent = "Ø§Ù„Ù…Ø²Ø§Ø¬: â€”";
        sourceBadge.textContent    = "Ø§Ù„Ù…ØµØ¯Ø±: â€”";
        return;
      }
      intentBadge.textContent    = "Ø§Ù„Ù†ÙŠØ©: " + (info.intentLabel || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©");
      sentimentBadge.textContent = "Ø§Ù„Ù…Ø²Ø§Ø¬: " + (info.sentimentLabel || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯");
      sourceBadge.textContent    = "Ø§Ù„Ù…ØµØ¯Ø±: " + (info.source || "Ù…Ø­Ù„ÙŠ");
    }

    function pushVoiceHistoryItem(item){
      state.voiceHistory.unshift(item);
      if(state.voiceHistory.length>20) state.voiceHistory.pop();
      renderVoiceHistoryList();
    }

    function renderVoiceHistoryList(){
      voiceHistoryList.innerHTML = "";
      if(!state.voiceHistory.length){
        voiceHistoryList.innerHTML = `<div class="history-item"><span>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± ØµÙˆØªÙŠØ© Ø¨Ø¹Ø¯.</span></div>`;
        return;
      }
      state.voiceHistory.forEach(h=>{
        const div = document.createElement("div");
        div.className = "history-item";
        div.innerHTML = `
          <div>
            <div>${h.text || ""}</div>
            <div class="meta">
              ${h.intentLabel ? `<span>Ù†ÙŠØ©: ${h.intentLabel}</span>` : ""}
              ${h.sentimentLabel ? `<span style="margin-inline:6px;">| Ù…Ø²Ø§Ø¬: ${h.sentimentLabel}</span>` : ""}
            </div>
          </div>
          <div>
            <span class="badge-date">${h.date || ""}</span>
          </div>
        `;
        voiceHistoryList.appendChild(div);
      });
    }

    // Ø³Ù†Ø±Ø¨Ø· Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ù€ voice.js Ùˆ intent-engine.js Ù„ØªÙ†ÙÙŠØ° Ø­Ù‚ÙŠÙ‚ÙŠ
    document.getElementById("startVoiceBtn").addEventListener("click", ()=>{
      if(window.voiceEngine && window.voiceEngine.start){
        window.voiceEngine.start();
      } else {
        setVoiceStatus(true, "ÙŠØ³ØªÙ…Ø¹ (Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù…)...");
      }
    });
    document.getElementById("stopVoiceBtn").addEventListener("click", ()=>{
      if(window.voiceEngine && window.voiceEngine.stop){
        window.voiceEngine.stop();
      }
      setVoiceStatus(false, "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹.");
    });

    document.getElementById("applyVoiceActionBtn").addEventListener("click", ()=>{
      alert("ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ Ø³ÙŠÙÙ†ÙÙ‘ÙØ° Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø¹Ø¯ Ø±Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙØ¹Ù„ÙŠ.");
    });
    document.getElementById("clearVoiceUiBtn").addEventListener("click", ()=>{
      voiceRawText.value = "";
      voiceInterpretation.value = "";
      updateVoiceBadges(null);
    });

    // ====== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ =====
    function init(){
      loadData();
      setupTabs();
      setupClientsSearch();
      addEntryRow();
      dateInput.value = new Date().toISOString().slice(0,10);
      renderClientsList();
      renderReportClientsOptions();
      updatePreviewText();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>

  <script src="intent-engine.js"></script>
  <script src="voice.js"></script>
</body>
</html>
