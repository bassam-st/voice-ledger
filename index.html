<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø¯ÙØªØ± ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#16a34a" />

  <style>
    * { box-sizing: border-box; }
    :root {
      --green: #16a34a;
      --green-dark: #15803d;
      --red: #dc2626;
      --bg: #f3f4f6;
      --card: #ffffff;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-lg: 14px;
      --radius-md: 10px;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, sans-serif;
      background: var(--bg);
      color: var(--text-main);
      font-size: 16px;
    }
    .app-shell {
      max-width: 950px;
      margin: 0 auto;
      padding: 16px 10px 40px;
    }
    h1 {
      text-align: center;
      font-size: 1.6rem;
      margin: 8px 0 4px;
    }
    .subtitle {
      text-align: center;
      font-size: .95rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .card {
      background: #fff;
      border-radius: var(--radius-lg);
      padding: 14px;
      box-shadow: 0 8px 20px rgba(15,23,42,.06);
      border: 1px solid var(--border);
      margin-bottom: 14px;
      font-size: 1rem;
    }

    label { display: block; font-size: .9rem; color: var(--text-muted); margin-bottom: 3px; }
    .row { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
    .row > * { flex: 1; }

    input, select, textarea {
      width: 100%;
      padding: 9px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      font-size: 1rem;
    }

    button {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
    .btn-green { background: var(--green); color: #fff; }
    .btn-red { background: var(--red); color: #fff; }

    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: #e5e7eb;
      border-radius: 999px;
      padding: 4px;
      margin-bottom: 12px;
    }
    .tab {
      text-align: center;
      padding: 10px 4px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 1rem;
    }
    .tab.active { background: var(--green); color: #fff; }
  </style>
</head>

<body>
  <div class="app-shell">

    <h1>Ø¯ÙØªØ± ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸ“’</h1>
    <p class="subtitle">Ø­ÙØ¸ ÙƒØ´ÙˆÙØ§Øª Ø¹Ù…Ù„Ø§Ø¦Ùƒ ÙÙŠ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø­Ø³Ø§Ø¨)</p>

    <!-- Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ -->
    <div style="text-align:center; margin:15px 0;">
      <button id="voiceAssistantBtn"
              style="background:#15803d; color:white; padding:12px 22px;
                     border:none; border-radius:50px; font-size:1.1rem;">
          ğŸ¤ Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø³Ù‘Ø§Ù… Ø§Ù„ØµÙˆØªÙŠ
      </button>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="tabs">
      <div class="tab active" id="tab-statements">Ø§Ù„ÙƒØ´ÙˆÙØ§Øª</div>
      <div class="tab" id="tab-clients">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
    </div>

    <!-- Ø¨Ø¯Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„ÙƒØ´ÙˆÙØ§Øª -->
    <div id="statementsSection">
      <div class="card">
        <label>Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
        <input id="clientName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">

        <div class="row">
          <div>
            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
            <input id="dateInput" type="date">
          </div>
        </div>

        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ´Ù:</label>
        <input id="statementTitle" placeholder="Ù…Ø«Ø§Ù„: Ø¨ÙŠØ§Ù† Ø´Ø­Ù†Ø©ØŒ ØªØ³ÙˆÙŠØ© Ø­Ø³Ø§Ø¨...">

        <h3 style="margin:12px 0;">Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ğŸ“‹</h3>
        <p style="font-size:.85rem; color:var(--text-muted); margin-top:-8px;">
          ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¨Ù†ÙˆØ¯ Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆØªØ­Ø¯ÙŠØ¯ (Ù„Ù‡ / Ø¹Ù„ÙŠÙ‡) ÙˆØ§Ù„Ø¹Ù…Ù„Ø© ÙˆØ§Ù„Ù…Ø¨Ù„Øº.
        </p>

        <button class="btn-green" id="addEntryBtn">+ Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯</button>

        <div id="entriesContainer" style="margin-top:10px;"></div>

        <p style="margin-top:20px; font-size:.9rem;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</p>
        <div id="totalDisplay" style="font-weight:bold; font-size:1.1rem; margin-top:-6px;"></div>

        <button class="btn-green" id="saveStatementBtn" style="margin-top:15px;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙƒØ´Ù</button>
      </div>
      <!-- Ø³Ø¬Ù„ Ø§Ù„ÙƒØ´ÙˆÙØ§Øª -->
      <div class="card">
        <h3>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„ÙƒØ´ÙˆÙØ§Øª:</h3>
        <div id="statementsList"></div>
      </div>
    </div> <!-- Ù†Ù‡Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„ÙƒØ´ÙˆÙØ§Øª -->

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
    <div id="clientsSection" style="display:none;">
      <div class="card">
        <h3>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
        <div id="clientsList"></div>
      </div>
    </div>

  </div> <!-- Ù†Ù‡Ø§ÙŠØ© app-shell -->

  <!-- Ù…Ù„Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ -->
  <script src="voice.js"></script>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
    let statements = JSON.parse(localStorage.getItem("statements") || "[]");

    function saveData() {
      localStorage.setItem("statements", JSON.stringify(statements));
    }

    // ========== Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ==========
    const tabStatements = document.getElementById("tab-statements");
    const tabClients = document.getElementById("tab-clients");
    const statementsSection = document.getElementById("statementsSection");
    const clientsSection = document.getElementById("clientsSection");

    tabStatements.onclick = () => {
      tabStatements.classList.add("active");
      tabClients.classList.remove("active");
      statementsSection.style.display = "block";
      clientsSection.style.display = "none";
      renderClients();
    };

    tabClients.onclick = () => {
      tabClients.classList.add("active");
      tabStatements.classList.remove("active");
      clientsSection.style.display = "block";
      statementsSection.style.display = "none";
      renderClients();
    };

    // ========== Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ ==========
    const entriesContainer = document.getElementById("entriesContainer");
    document.getElementById("addEntryBtn").onclick = addEntryRow;

    function addEntryRow(desc = "", amount = "", currency = "ÙŠÙ…Ù†ÙŠ", direction = "Ø¹Ù„ÙŠÙ‡") {
      const wrapper = document.createElement("div");
      wrapper.className = "card";

      wrapper.innerHTML = `
        <div class="row">
          <input placeholder="ÙˆØµÙ Ø§Ù„Ø¨Ù†Ø¯" class="desc" value="${desc}">
        </div>

        <div class="row">
          <select class="direction">
            <option ${direction === "Ù„Ù‡" ? "selected" : ""}>Ù„Ù‡</option>
            <option ${direction === "Ø¹Ù„ÙŠÙ‡" ? "selected" : ""}>Ø¹Ù„ÙŠÙ‡</option>
          </select>

          <select class="currency">
            <option ${currency === "ÙŠÙ…Ù†ÙŠ" ? "selected" : ""}>ÙŠÙ…Ù†ÙŠ</option>
            <option ${currency === "Ø³Ø¹ÙˆØ¯ÙŠ" ? "selected" : ""}>Ø³Ø¹ÙˆØ¯ÙŠ</option>
          </select>

          <input class="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" type="number" value="${amount}">
        </div>

        <button class="btn-red deleteEntry">Ø­Ø°Ù</button>
      `;

      wrapper.querySelector(".deleteEntry").onclick = () => wrapper.remove();
      entriesContainer.appendChild(wrapper);
    }

    // ========== Ø­ÙØ¸ Ø§Ù„ÙƒØ´Ù ==========
    document.getElementById("saveStatementBtn").onclick = () => {
      const clientName = document.getElementById("clientName").value.trim();
      const date = document.getElementById("dateInput").value;
      const title = document.getElementById("statementTitle").value.trim();

      if (!clientName || !date) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®");
        return;
      }

      const entries = [...entriesContainer.children].map(w => ({
        desc: w.querySelector(".desc").value,
        amount: Number(w.querySelector(".amount").value),
        currency: w.querySelector(".currency").value,
        direction: w.querySelector(".direction").value
      }));

      statements.push({ clientName, date, title, entries });
      saveData();
      renderStatementsList();
      renderClients();

      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙƒØ´Ù âœ”ï¸");

      // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
      entriesContainer.innerHTML = "";
    };

    // ========== Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ´ÙˆÙØ§Øª ==========
    function renderStatementsList() {
      const list = document.getElementById("statementsList");
      list.innerHTML = "";

      statements.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "card";
        div.style.cursor = "pointer";
        div.innerHTML = `
          <strong>${s.clientName}</strong><br>
          Ø§Ù„ØªØ§Ø±ÙŠØ®: ${s.date}
        `;
        div.onclick = () => openStatement(i);
        list.appendChild(div);
      });
    }

    // ========== ÙØªØ­ ÙƒØ´Ù ==========
    function openStatement(i) {
      const s = statements[i];

      document.getElementById("clientName").value = s.clientName;
      document.getElementById("dateInput").value = s.date;
      document.getElementById("statementTitle").value = s.title;

      entriesContainer.innerHTML = "";
      s.entries.forEach(e => addEntryRow(e.desc, e.amount, e.currency, e.direction));

      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ¨ÙˆÙŠØ¨
      tabStatements.click();
    }

    // ========== Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ==========
    function renderClients() {
      const clients = [...new Set(statements.map(s => s.clientName))];
      const list = document.getElementById("clientsList");
      list.innerHTML = "";

      clients.forEach(c => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `ğŸ‘¤ ${c}`;
        div.onclick = () => filterByClient(c);
        list.appendChild(div);
      });
    }

    function filterByClient(name) {
      tabStatements.click();
      const filtered = statements.filter(s => s.clientName === name);

      const list = document.getElementById("statementsList");
      list.innerHTML = "";

      filtered.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <strong>${s.clientName}</strong><br>
          Ø§Ù„ØªØ§Ø±ÙŠØ®: ${s.date}
        `;
        list.appendChild(div);
      });
    }

    renderStatementsList();
    renderClients();
  </script>

</body>
</html>
